<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام أرشيف ثانوية محمد عبدالعزيز الكنعان</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    
    <style>
        :root { --main: #1e293b; --blue: #0ea5e9; --orange: #f59e0b; --bg: #f1f5f9; --card: #ffffff; --text: #334155; }
        body.dark-mode { --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --main: #38bdf8; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; direction: rtl; transition: 0.3s; }
        
        .container { max-width: 700px; margin: auto; padding: 20px; }
        .card { background: var(--card); padding: 20px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px; border: 1px solid rgba(0,0,0,0.05); }
        
        /* البحث الأنيق */
        .search-wrapper { display: flex; align-items: center; gap: 10px; background: var(--card); padding: 10px 20px; border-radius: 50px; border: 2px solid var(--blue); margin-bottom: 20px; }
        .search-wrapper input { border: none; background: transparent; flex: 1; color: var(--text); outline: none; font-size: 16px; }
        
        /* الإدخالات */
        .grid-inputs { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        input, select, textarea { background: var(--bg); color: var(--text); width: 100%; padding: 12px; margin-top: 8px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; outline: none; }
        
        /* الأزرار */
        .btn { border: none; border-radius: 10px; cursor: pointer; padding: 12px; font-weight: bold; color: white; display: flex; align-items: center; justify-content: center; gap: 8px; transition: 0.3s; }
        .btn-save { background: var(--main); width: 100%; margin-top: 15px; font-size: 16px; }
        .action-bar { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 15px; }
        
        /* القائمة */
        .student-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid rgba(0,0,0,0.05); }
        .student-item:last-child { border-bottom: none; }
        .highlight-badge { padding: 4px 12px; border-radius: 8px; font-weight: bold; font-size: 12px; }
        .qaid-badge { background: #dcfce7; color: #166534; }
        .page-badge { background: #fef9c3; color: #854d0e; }

        /* التحكم الإضافي */
        .theme-toggle { position: fixed; bottom: 20px; left: 20px; width: 50px; height: 50px; border-radius: 50%; background: var(--main); color: white; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 1000; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }

        /* نظام الطباعة المطور */
        .print-header, .print-footer, .print-only-table-head { display: none; }
        
        @media print {
            .no-print, .theme-toggle, .search-wrapper, .action-bar, .card:not(#listCard), i { display: none !important; }
            body { background: white !important; color: black !important; padding: 0; }
            .container { max-width: 100%; padding: 0; }
            .print-header { display: block !important; text-align: center; margin-bottom: 30px; }
            .print-header h1 { font-size: 20px; border-bottom: 2px solid black; padding-bottom: 10px; margin: 0; }
            
            #studentsList { display: table !important; width: 100%; border-collapse: collapse; }
            .student-item { display: table-row !important; }
            .student-info { display: table-cell !important; padding: 10px; border: 1px solid black; text-align: center; vertical-align: middle; }
            .print-only-table-head { display: table-row !important; background: #eee !important; font-weight: bold; }
            .highlight-badge { background: transparent !important; color: black !important; padding: 0 !important; font-weight: bold; }
            .print-footer { display: block !important; margin-top: 50px; text-align: center; font-weight: bold; }
        }

        /* صفحة تسجيل الدخول */
        #loginPage { height: 100vh; display: flex; align-items: center; justify-content: center; background: var(--bg); }
    </style>
</head>
<body>

<div id="loginPage">
    <div class="card" style="width: 320px; text-align: center;">
        <i class="fas fa-database fa-3x" style="color: var(--blue); margin-bottom: 15px;"></i>
        <h3 style="margin-bottom: 20px;">نظام أرشيف الكنعان</h3>
        <input type="email" id="loginEmail" placeholder="البريد الإلكتروني">
        <input type="password" id="loginPass" placeholder="كلمة المرور">
        <button class="btn btn-save" onclick="login()">دخول</button>
    </div>
</div>

<div id="appContent" class="container" style="display: none;">
    <div class="print-header">
        <h1>فهرس القيد العام ث.ش محمد عبدالعزيز الكنعان للبنين</h1>
    </div>

    <div class="no-print" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
        <span>العدد الإجمالي: <b id="totalCount" style="color:var(--blue)">0</b> سجل</span>
        <button onclick="logout()" style="color:#ef4444; border:none; background:none; cursor:pointer; font-weight:bold;"><i class="fas fa-sign-out-alt"></i> خروج</button>
    </div>

    <div class="card no-print">
        <input type="hidden" id="editId">
        <div class="grid-inputs">
            <input type="text" id="fName" placeholder="الاسم الرباعي">
            <input type="text" id="surname" placeholder="اللقب">
        </div>
        <div class="grid-inputs">
            <input type="text" id="mName" placeholder="اسم الأم">
            <input type="text" id="qNum" placeholder="رقم القيد
