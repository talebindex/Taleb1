<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø£Ø±Ø´ÙŠÙ Ø§Ù„ÙƒÙ†Ø¹Ø§Ù† Ø§Ù„Ø°ÙƒÙŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <style>
        body { background-color: #0f172a; color: white; font-family: 'Segoe UI', sans-serif; }
        .card { background: #1e293b; border-radius: 1rem; padding: 1.5rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3); }
        .input-style { background: #334155; border: 1px solid #475569; border-radius: 0.5rem; padding: 0.7rem; width: 100%; color: white; outline: none; }
        .input-style:focus { border-color: #10b981; }
        .btn-save { background: #10b981; transition: 0.3s; width: 100%; padding: 0.8rem; border-radius: 0.5rem; font-weight: bold; }
        .btn-save:hover { background: #059669; transform: translateY(-2px); }
        .btn-save:disabled { background: #475569; cursor: not-allowed; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-4xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-bold text-emerald-400 mb-2">Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ø±Ù‚Ù…ÙŠ</h1>
            <p class="text-slate-400">Ù†Ø¸Ø§Ù… ØªØ®Ø²ÙŠÙ† Ø³Ø­Ø§Ø¨ÙŠ ØºÙŠØ± Ù…Ø­Ø¯ÙˆØ¯ Ø¹Ø¨Ø± Telegram API</p>
        </header>

        <div class="card mb-10">
            <h2 class="text-xl font-semibold mb-6 flex items-center gap-2 text-emerald-300">
                <span>ğŸ“¥</span> ØªØ³Ø¬ÙŠÙ„ Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯
            </h2>
            <form id="studentForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <input type="text" id="name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ø·Ø§Ù„Ø¨" class="input-style" required>
                <input type="text" id="uid" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‚ÙŠØ¯" class="input-style" required>
                
                <div class="space-y-2">
                    <label class="text-sm text-slate-400">Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ© (Ø§Ù„Ø¬ÙˆØ¯Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©)</label>
                    <input type="file" id="pPhoto" class="input-style" accept="image/*">
                </div>

                <div class="space-y-2">
                    <label class="text-sm text-slate-400">ØµÙˆØ±Ø© ØµÙØ­Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</label>
                    <input type="file" id="iPage" class="input-style" accept="image/*">
                </div>

                <button type="submit" id="saveBtn" class="md:col-span-2 btn-save">Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙ</button>
            </form>
            <div id="status" class="hidden mt-4 p-3 rounded text-center bg-emerald-500/10 text-emerald-400 border border-emerald-500/20">
                Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± Ù„Ù„Ø£Ø±Ø´ÙŠÙ.. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
            </div>
        </div>

        <div class="card">
            <h2 class="text-xl font-semibold mb-6 text-emerald-300">Ø³Ø¬Ù„ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø£Ø±Ø´ÙÙŠÙ†</h2>
            <div class="overflow-x-auto text-right">
                <table class="w-full border-collapse">
                    <thead>
                        <tr class="text-slate-500 border-b border-slate-700">
                            <th class="p-3">Ø±Ù‚Ù… Ø§Ù„Ù‚ÙŠØ¯</th>
                            <th class="p-3">Ø§Ù„Ø§Ø³Ù…</th>
                            <th class="p-3">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
                        </tr>
                    </thead>
                    <tbody id="listBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="modal" class="fixed inset-0 bg-black/90 hidden items-center justify-center p-4 z-50">
        <div class="bg-slate-800 w-full max-w-2xl rounded-2xl p-8 relative">
            <button onclick="closeModal()" class="absolute top-4 left-4 text-2xl hover:text-red-500">âœ•</button>
            <div id="modalContent" class="text-center"></div>
        </div>
    </div>

    <script>
        // --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ ---
        // (Ø¶Ø¹ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ Ù‡Ù†Ø§ Ù„ØªÙØ¹ÙŠÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª)
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªÙ„Ø¬Ø±Ø§Ù… Ø§Ù„ØªÙŠ Ø²ÙˆØ¯ØªÙ†ÙŠ Ø¨Ù‡Ø§ ---
        const TG = {
            TOKEN: '8513150426:AAFVDjMF-2hfWiW-4CCc3WNxWXnuQ4WfMFY',
            CHAT_ID: '-1003325942139'
        };

        // Ø¯Ø§Ù„Ø© Ø§Ù„Ø±ÙØ¹ Ù„ØªÙ„Ø¬Ø±Ø§Ù… ÙƒÙ…Ù„Ù (Document) Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ù†Ù‚Øµ Ø§Ù„Ø¬ÙˆØ¯Ø©
        async function uploadFile(file, studentId, type) {
            const formData = new FormData();
            formData.append('chat_id', TG.CHAT_ID);
            formData.append('document', file);
            formData.append('caption', `Ø·Ø§Ù„Ø¨: ${studentId} | Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù: ${type}`);

            const res = await fetch(`https://api.telegram.org/bot${TG.TOKEN}/sendDocument`, {
                method: 'POST',
                body: formData
            });
            const data = await res.json();
            return data.ok ? data.result.document.file_id : null;
        }

        // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        document.getElementById('studentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('saveBtn');
            const status = document.getElementById('status');
            
            btn.disabled = true;
            status.classList.remove('hidden');

            const pFile = document.getElementById('pPhoto').files[0];
            const iFile = document.getElementById('iPage').files[0];
            const sName = document.getElementById('name').value;
            const sId = document.getElementById('uid').value;

            try {
                const pId = pFile ? await uploadFile(pFile, sId, "Ø´Ø®ØµÙŠØ©") : null;
                const iId = iFile ? await uploadFile(iFile, sId, "ØµÙØ­Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª") : null;

                await db.collection("students_archive").add({
                    name: sName,
                    uid: sId,
                    photoId: pId,
                    infoId: iId,
                    date: new Date().toISOString()
                });

                alert("ØªÙ…Øª Ø§Ù„Ø£Ø±Ø´ÙØ© Ø¨Ù†Ø¬Ø§Ø­ ÙÙŠ ØªÙ„Ø¬Ø±Ø§Ù… Ùˆ Firebase");
                e.target.reset();
            } catch (err) {
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„");
            } finally {
                btn.disabled = false;
                status.classList.add('hidden');
            }
        });

        // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¹Ø±Ø¶Ù‡Ø§
        db.collection("students_archive").orderBy("date", "desc").onSnapshot(snap => {
            const list = document.getElementById('listBody');
            list.innerHTML = '';
            snap.forEach(doc => {
                const s = doc.data();
                list.innerHTML += `
                    <tr class="border-b border-slate-800 hover:bg-slate-700/30 transition">
                        <td class="p-4 text-emerald-400 font-mono">${s.uid}</td>
                        <td class="p-4 font-bold">${s.name}</td>
                        <td class="p-4">
                            <button onclick="showProfile('${doc.id}')" class="bg-slate-700 px-3 py-1 rounded text-sm hover:bg-emerald-600 transition">ØªØ­Ù…ÙŠÙ„/Ø¹Ø±Ø¶</button>
                        </td>
                    </tr>
                `;
            });
        });

        async function showProfile(id) {
            const doc = await db.collection("students_archive").doc(id).get();
            const s = doc.data();
            const content = document.getElementById('modalContent');
            
            content.innerHTML = `
                <h3 class="text-2xl font-bold mb-4">${s.name}</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-slate-700 p-4 rounded-xl">
                        <p class="text-sm text-slate-400 mb-2">Ù…Ø¹Ø±Ù Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©</p>
                        <code class="text-xs text-emerald-300 break-all">${s.photoId || 'Ù„Ø§ ØªÙˆØ¬Ø¯'}</code>
                    </div>
                    <div class="bg-slate-700 p-4 rounded-xl">
                        <p class="text-sm text-slate-400 mb-2">Ù…Ø¹Ø±Ù ØµÙØ­Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</p>
                        <code class="text-xs text-sky-300 break-all">${s.infoId || 'Ù„Ø§ ØªÙˆØ¬Ø¯'}</code>
                    </div>
                </div>
                <div class="mt-6 text-sm text-slate-400 leading-relaxed">
                    ğŸ’¡ Ø§Ù„ØµÙˆØ± Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø£Ù…Ø§Ù† ÙÙŠ Ù‚Ù†Ø§ØªÙƒ Ø§Ù„Ø®Ø§ØµØ© Ø¹Ù„Ù‰ ØªÙ„Ø¬Ø±Ø§Ù….<br>
                    ÙŠÙ…ÙƒÙ†Ùƒ Ø¬Ù„Ø¨ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© (5MB) Ù…Ù† Ø§Ù„Ù‚Ù†Ø§Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù€ ID Ø§Ù„Ù…ÙˆØ¶Ø­ Ø£Ø¹Ù„Ø§Ù‡.
                </div>
            `;
            document.getElementById('modal').classList.remove('hidden');
            document.getElementById('modal').classList.add('flex');
        }

        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
            document.getElementById('modal').classList.remove('flex');
        }
    </script>
</body>
</html>
